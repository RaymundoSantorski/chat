(this.webpackJsonpchat=this.webpackJsonpchat||[]).push([[0],{100:function(e,t,c){"use strict";c.r(t);var s=c(0),n=c(28),a=c.n(n),r=c(9),o=c(36),i=c(3),u=c(5),j="[socket] set",l=c(16),d=c(4),b=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object(s.useState)(e),c=Object(u.a)(t,2),n=c[0],a=c[1],r=function(){a(e)},o=function(e){var t=e.target;a(Object(d.a)(Object(d.a)({},n),{},Object(l.a)({},t.name,t.value)))};return[n,o,r]},O=c(1),f=function(){var e=Object(r.b)(),t=b({password:"",user:""}),c=Object(u.a)(t,2),s=c[0],n=c[1],a=s.password,o=s.user;return Object(O.jsxs)("div",{className:"loginScreen",children:[Object(O.jsx)("p",{children:"Iniciar sesi\xf3n"}),Object(O.jsx)("input",{type:"text",name:"user",value:o,onChange:n,placeholder:"Nombre de usuario"}),Object(O.jsx)("input",{type:"password",name:"password",value:a,onChange:n,placeholder:"Contrase\xf1a"}),Object(O.jsx)("button",{onClick:function(){e({type:j,payload:o})},children:"Iniciar"})]})},v=function(){return Object(O.jsx)("div",{children:"Register"})},h=c(56),m=c(25),x=c(57),p=c.n(x),g=function(e){var t=e.setTo,c=e.to,n=e.messages,a=void 0===n?[]:n,o=e.socket,i=e.setMessages,j=e.last,f=e.users,v=Object(r.c)((function(e){return e.sockets})).socket,h=b({value:""}),x=Object(u.a)(h,3),p=x[0].value,g=x[1],N=x[2],k=Object(s.useRef)();return Object(s.useEffect)((function(){(null===c||void 0===c?void 0:c.user)===j&&k.current.scrollIntoView(!1)}),[a]),Object(s.useEffect)((function(){var e=f.find((function(e){return e.user===c.user}));e&&!c.id?t(e):!e&&c.id&&t({user:c.user,id:null})}),[f,t,c]),Object(s.useEffect)((function(){var e=a,t=e.slice().pop();t&&!t.read&&(t.read=!0,i((function(s){return console.log(t),Object(d.a)(Object(d.a)({},s),{},Object(l.a)({},c.user,Object(m.a)(e)))})))}),[a]),Object(O.jsx)("div",{className:"chat",children:Object(O.jsxs)("div",{className:"viewMessages",ref:k,children:[Object(O.jsx)("div",{children:a.map((function(e){return Object(O.jsx)("div",{className:e.sender===v?"message self":"message",children:Object(O.jsx)("p",{className:"messageText",children:e.value})})}))}),c.id?Object(O.jsxs)("div",{className:"chatSend",children:[Object(O.jsx)("input",{name:"value",value:p,onChange:g,placeholder:"Escribe un mensaje",className:"messageInput",type:"text",autoComplete:"off"}),Object(O.jsx)("button",{className:"messageSendButton",onClick:function(){p.trim().length>0&&(i((function(e){return Object(d.a)(Object(d.a)({},e),{},Object(l.a)({},c.user,[].concat(Object(m.a)(e[c.user]||[]),[{value:p,sender:v,read:!0}])))})),o.emit("message",{to:c.id,value:p}),N()),k.current.scrollIntoView(!1)},children:"\u276f"})]}):Object(O.jsx)("div",{className:"chatSend",children:Object(O.jsx)("center",{children:Object(O.jsx)("p",{children:" El usuario est\xe1 desconectado "})})})]})})},N=function(e){var t=e.messages,c=void 0===t?{}:t,s=e.setTo,n=e.users,a=Object.keys(c);return Object(O.jsx)("div",{className:"chat",children:a.map((function(e){var t=n.find((function(t){return t.user===e})),a=null===t||void 0===t?void 0:t.id,r=c[e].slice().pop();return Object(O.jsxs)("div",{onClick:function(){s({user:e,id:a})},className:a?"chatItem active":"chatItem",children:[Object(O.jsx)("p",{className:"chatSender",children:e}),Object(O.jsx)("p",{className:r.read?"lastMessage read":"lastMessage",children:r.value})]})}))})},k=function(e){var t=e.online,c=e.users,n=e.setTo,a=e.to,o=e.close,i=Object(r.c)((function(e){return e.sockets})).socket,j=Object(s.useState)(!1),l=Object(u.a)(j,2),d=l[0],b=l[1];return Object(O.jsxs)("div",{className:t?"navbar online":"navbar",children:[Object(O.jsxs)("div",{className:d?"modal show":"modal",children:[Object(O.jsx)("div",{className:"modalOffset",onClick:function(){b(!1)}}),Object(O.jsx)("div",{className:"modalContent",children:c.map((function(e){var t=e.user,c=e.id;return Object(O.jsxs)("div",{className:"modalUser",onClick:function(){n({user:t,id:c})},children:[Object(O.jsx)("div",{className:"modalUserImg"}),t]},c)}))})]}),Object(O.jsxs)("div",{className:"row",children:[a&&Object(O.jsx)("p",{className:"reverse",onClick:o,children:"\u279c"}),Object(O.jsx)("h3",{children:a?"".concat(i," \u276f ").concat(a.user):"".concat(i)})]}),Object(O.jsxs)("div",{className:d?"burger active":"burger",onClick:function(){b(!d)},children:[Object(O.jsx)("div",{className:"burgerTop"}),Object(O.jsx)("div",{className:"burgerMiddle"}),Object(O.jsx)("div",{className:"burgerBottom"})]})]})},S=function(){var e=Object(i.g)(),t=Object(s.useState)([]),c=Object(u.a)(t,2),n=c[0],a=c[1],o=Object(s.useState)(!1),j=Object(u.a)(o,2),b=j[0],f=j[1],v=Object(s.useState)(null),x=Object(u.a)(v,2),S=x[0],E=x[1],w=Object(s.useState)(null),C=Object(u.a)(w,2),y=C[0],I=C[1],T=Object(s.useState)(JSON.parse(localStorage.getItem("messages"))||{}),M=Object(u.a)(T,2),_=M[0],J=M[1],B=Object(r.c)((function(e){return e.sockets})).socket,R=Object(s.useState)(void 0),U=Object(u.a)(R,2),V=U[0],D=U[1];return B&&!V?D(p.a.connect("https://apapachatestore.com",{transports:["websocket"]})):B||e.replace("/chat/login"),Object(s.useEffect)((function(){f(null===V||void 0===V?void 0:V.connected)}),[V]),Object(s.useEffect)((function(){null===V||void 0===V||V.on("connect",(function(){f(!0),V.emit("[server] register",{name:B})}))}),[V]),Object(s.useEffect)((function(){null===V||void 0===V||V.on("disconnect",(function(){f(!1)}))}),[V]),Object(s.useEffect)((function(){null===V||void 0===V||V.on("[client] list",(function(e){a(e)}))}),[V]),Object(s.useEffect)((function(){null===V||void 0===V||V.on("message",(function(e){var t=e.value,c=e.from,s={value:t,sender:c,read:!1};I(c),J((function(e){return Object(d.a)(Object(d.a)({},e),{},Object(l.a)({},c,[].concat(Object(m.a)(e[c]||[]),[s])))}))}))}),[V]),Object(s.useEffect)((function(){localStorage.setItem("messages",JSON.stringify(_))}),[_]),Object(s.useEffect)((function(){var e,t=Object(h.a)(n);try{for(t.s();!(e=t.n()).done;){var c=e.value;console.log(c),(null===c||void 0===c?void 0:c.user)===(null===S||void 0===S?void 0:S.user)&&E(Object(d.a)(Object(d.a)({},S),{},{id:c.id}))}}catch(s){t.e(s)}finally{t.f()}}),[n]),Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)(k,{online:b,users:n,setTo:E,to:S,close:function(){E(null)}}),S?Object(O.jsx)(g,{setTo:E,to:S,socket:V,messages:_[S.user],setMessages:J,last:y,users:n}):Object(O.jsx)(N,{messages:_,setTo:E,users:n})]})},E=function(){var e=Object(r.c)((function(e){return e.sockets})).socket;return Object(O.jsx)(o.a,{children:Object(O.jsx)("div",{children:Object(O.jsxs)(i.d,{children:[Object(O.jsx)(i.b,{exact:!0,path:"/chat/login",children:e?Object(O.jsx)(i.a,{to:"/chat/"}):Object(O.jsx)(f,{})}),Object(O.jsx)(i.b,{exact:!0,path:"/chat/register",children:e?Object(O.jsx)(i.a,{to:"/chat/"}):Object(O.jsx)(v,{})}),Object(O.jsx)(i.b,{path:"/chat/",children:Object(O.jsx)(S,{})})]})})})},w=function(){return Object(O.jsx)(E,{})},C=c(58),y=c(17),I={},T="undefined"!==typeof window&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||y.d,M=Object(y.c)({sockets:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:I,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case j:return Object(d.a)(Object(d.a)({},e),{},{socket:t.payload});default:return e}}}),_=Object(y.e)(M,T(Object(y.a)(C.a)));c(99);a.a.render(Object(O.jsx)(r.a,{store:_,children:Object(O.jsx)(w,{})}),document.getElementById("root"))},99:function(e,t,c){}},[[100,1,2]]]);
//# sourceMappingURL=main.154ad75f.chunk.js.map